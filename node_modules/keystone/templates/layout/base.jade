include ../mixins/flashMessages

doctype html
html
	head
		meta(charset="utf-8")
		meta(name="viewport", content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width")

		title= title

		//include some css
		include ./base_css
		//- Common
		script(src="/keystone/js/lib/underscore/underscore-1.5.1.min.js")
		script(src="/keystone/js/lib/jquery/jquery-1.10.2.min.js")
		script(src="/keystone/js/lib/async/async.js")
		script(src="/js/sweet-alert.min.js")

		block css
		block head

	body(id='page-' + page, class="animated-content")

		header(id="topnav", class="navbar navbar-bluegray navbar-fixed-top")
				div(class="logo-area")
					span(id="trigger-sidebar", class="toolbar-trigger toolbar-icon-bg")
						a(data-toggle="tooltips",data-placement="right",title="Toggle Sidebar")
							span(class="icon-bg")
								i(class="ti ti-shift-left")
		
					a(class="navbar-brand",href="/")|Bellema

				div(class="yamm navbar-left navbar-collapse collapse in")
					ul(class="nav navbar-nav")

						li(class="dropdown")
							a(href="#",class="dropdown-toggle",data-toggle="dropdown")
								|HOME PAGE
								span(class="caret")
							ul(class="dropdown-menu",role="menu")
								li
									a(href="/keystone/banners?sort=sort")|Banner
								li(class="divider")
								li
									a(href="/keystone/customer-feedbacks?sort=sort")|Customer Feedbacks
								li(class="divider")
								li
									a(href="/keystone/partners?sort=sort")|Partners
								li(class="divider")
								li
									a(href="/keystone/advs?sort=sort")|Advs
								li(class="divider")
								li
									a(href="/keystone/policies")|Privacy Policy
								

						li(class="dropdown")
							a(href="#",class="dropdown-toggle",data-toggle="dropdown")
								|PRODUCTS
								span(class="caret")
							ul(class="dropdown-menu",role="menu")
								li
									a(href="/keystone/products?sort=sort")|Products
								li(class="divider")
								li
									a(href="/keystone/product-categories?sort=sort")|Product Category
								li(class="divider")
								li
									a(href="/keystone/reviews?sort=sort")|Review

						li(class="dropdown")
							a(href="#",class="dropdown-toggle",data-toggle="dropdown")
								|DISTRIBUTORS
								span(class="caret")
							ul(class="dropdown-menu",role="menu")
								li
									a(href="/keystone/distributors?sort=sort")|Distributor
								li
									a(href="/keystone/shops?sort=sort")|Shops


						li(class="dropdown")
							a(href="#",class="dropdown-toggle",data-toggle="dropdown")
								|BLOGS
								span(class="caret")
							ul(class="dropdown-menu",role="menu")
								li
									a(href="/keystone/blogs?sort=sort")|Blog
								li(class="divider")
								li
									a(href="/keystone/blog-categories")|Blog Categories

						li(class="dropdown")
							a(href="#",class="dropdown-toggle",data-toggle="dropdown")
								|SUBSCRIBERS
								span(class="caret")
							ul(class="dropdown-menu",role="menu")
								li
									a(href="/keystone/subscribers")|Subscribers

						li(class="dropdown")
							a(href="#",class="dropdown-toggle",data-toggle="dropdown")
								|FAQs 
								span(class="caret")
							ul(class="dropdown-menu",role="menu")
								li
									a(href="/keystone/faqs?sort=sort")|FAQs


						li(class="dropdown")
							a(href="#",class="dropdown-toggle",data-toggle="dropdown")
								|SETTINGS
								span(class="caret")
							ul(class="dropdown-menu",role="menu")
								li
									a(href="/keystone/socials")|Social Media
									a(href="/keystone/index-intros")|Index Intro


						li(class="dropdown")
							a(href="#",class="dropdown-toggle",data-toggle="dropdown")
								|USERS
								span(class="caret")
							ul(class="dropdown-menu",role="menu")
								li
									a(href="/keystone/users")|Users


				ul(class="nav navbar-nav toolbar pull-right")
					li(class="toolbar-icon-bg hidden-xs", id="trigger-extrabar")
						a(href="#")
							span(class="icon-bg")
								i(class="ti ti-view-grid")
					li(class="toolbar-icon-bg hidden-xs", id="trigger-fullscreen")
						a(href="#", class="toggle-fullscreen")
							span(class="icon-bg")
								i(class="ti ti-fullscreen")

					li(class="dropdown toolbar-icon-bg")
						a(href="#",class="dropdown-toggle", data-toggle="dropdown", aria-expanded="false")
							span(class="icon-bg")
								i(class="ti ti-user")
						ul(class="dropdown-menu userinfo",role="menu")
							li
								a(href="/keystone/users")
									i(class="ti ti-settings")
									span Settings
							li(class="divider")
							li
								a(href="/keystone/signout")
									i(class="ti ti-shift-right")
									span Sign Out

		#wrapper
			#layout-static

				div(class="static-sidebar-wrapper sidebar-bluegray")
					div(class="static-sidebar",style="top: 56px;")
						div(class="widget stay-on-collapse", id="widget-sidebar")
							.sidebar
								nav(class="widget-body")
									ul(class="acc-menu")

										li(class="nav-separator")
											span|MENU

										li
											a(href="/keystone/")
												i(class="ti ti-home")
												span|INDEX

										li(class="hasChild")
											a(href="javascript:;")
												i(class="fa fa-file-code-o")</i>
													span|HOME PAGE
											ul(class="acc-menu")
												li
													a(href="/keystone/banners?sort=sort")|Banner
												li
													a(href="/keystone/customer-feedbacks?sort=sort")|Customer Feedbacks
												li
													a(href="/keystone/partners?sort=sort")|Partners
												li
													a(href="/keystone/advs?sort=sort")|Advs
												li
													a(href="/keystone/policies")|Privacy Policy


										li(class="hasChild")
											a(href="javascript:;")
												i(class="fa fa-shopping-cart")</i>
													span|PRODUCTS
											ul(class="acc-menu")
												li
													a(href="/keystone/products?sort=sort")|Products
												li
													a(href="/keystone/product-categories?sort=sort")|Product Category
												li
													a(href="/keystone/reviews?sort=sort")|Review

										li(class="hasChild")
											a(href="javascript:;")
												i(class="fa fa-users")</i>
													span|DISTRIBUTORS
											ul(class="acc-menu")
												li
													a(href="/keystone/distributors?sort=sort")|Distributor
												li
													a(href="/keystone/shops?sort=sort")|Shops
												

										li(class="hasChild")
											a(href="javascript:;")
												i(class="ti ti-file")</i>
													span|BLOGS
											ul(class="acc-menu")
												li
													a(href="/keystone/blogs?sort=sort")|Blogs
												li
													a(href="/keystone/blog-categories")|Blog Categories

										li(class="hasChild")
											a(href="javascript:;")
												i(class="fa fa-rss")</i>
													span|SUBSCRIBERS
											ul(class="acc-menu")
												li
													a(href="/keystone/subscribers")|Subscribers

										li(class="hasChild")
											a(href="javascript:;")
												i(class="fa fa-info-circle")</i>
													span|FAQs
											ul(class="acc-menu")
												li
													a(href="/keystone/faqs?sort=sort")|FAQs

										li(class="hasChild")
											a(href="javascript:;")
												i(class="fa fa-gear")</i>
													span|SETTINGS
											ul(class="acc-menu")
												li
													a(href="/keystone/socials?sort=sort")|Social Media
												li
													a(href="/keystone/index-intros?sort=sort")|Index Intro

										li(class="hasChild")
											a(href="javascript:;")
												i(class="ti ti-user")</i>
													span|USERS
											ul(class="acc-menu")
												li
													a(href="/keystone/users")|Users

										li(class="nav-separator")
											span|&nbsp;

				.static-content-wrapper
					.static-content
						.page-content
							include ./base_bread
							block intro
							+flash-messages(messages)
							block content

					include ./base_foot
		
		//include js
		include ./base_js
		//- Page Scripts
		block js


script.
	$(function(){

		var curUri =  location.pathname;
		//shop get record
		if(/^\/keystone\/shops\/(.*)$/.test(curUri)){
			setTimeout(function(){

				$('input[name="address"]').change(function(){
						var v = $(this).val().trim();
						v = encodeURIComponent(v)

						var url = 'https://maps.googleapis.com/maps/api/geocode/json?address='+v+'&key=AIzaSyAxoHn2ExXBMjvV522DUrL-5jeFZ3im_PU';

						$.get(url,{_:Date.now()}, function(d){
							try{
								if(d.status == 'OK'){
									var lat = d.results[0].geometry.location.lat;
									var lng =  d.results[0].geometry.location.lng;
									$('input[name="lat"]')[0].value = lat;
									$('input[name="lat"]').change();

									$('input[name="lng"]')[0].value = lng;
									$('input[name="lng"]').trigger('change');
									
									$('input[name="lng"]').attr('data-reactid', '')
									$('input[name="lat"]').attr('data-reactid', '')

									sweetAlert("ok", "Lat Lng Auto Input", "success");
								}else{
									sweetAlert("Oops...", "Google Map Api Error!", "error");
								}
							}catch(e){
								sweetAlert("Oops...", "Google Map Result Parse Error!", "error");
							}
							
							console.log(d)

						},'json')

				})

			},500)
			
		}


		if(/^\/keystone\/blogs$/.test(curUri)){
			var btnStr = '<button id="syncFb" type="button" class="btn btn-default btn-create btn-create-item" style="margin-left:50px;"><span>Sync from facebook</span></button>'
			
			$('#list-view .toolbar').append(btnStr);

			setTimeout(function(){
				$('#syncFb').click(function(){
					$.post('/sync/fb/fd6c3f5ad15338e4a3c6b79fca2c8468', {}, function(d){
						if(d.error == 1){
							sweetAlert("Oops...", d.data, "error");
						}else{
							sweetAlert("Success sync from facebook");
							setTimeout(function(){
								location.href = location.href;
							},1000)
						}
					},'json').error(function(){
							sweetAlert("Oops...", 'request fail', "error");
					});
				})
			},100)

		}



		if($('#bread_pos').length > 0){
			var breadHref = ($('#bread_pos').attr('href') || '').trim();
			if(breadHref){
				if(breadHref != '/keystone/policies' && 
				   breadHref != '/keystone/blog-categories' &&
				   breadHref != '/keystone/subscribers' &&
				   breadHref != '/keystone/users'){
				   	$('#bread_pos').attr('href', breadHref+'?sort=sort')
				}
			}
		}

		setTimeout(function(){
			if($('.item-breadcrumbs').length === 1){
				var lia = $('.item-breadcrumbs').find('li').eq(1).find('a').eq(0);
				
				if(lia.length > 0){
					var breadHref = (lia.attr('href') || '').trim();
					if(breadHref){
						if(breadHref != '/keystone/policies' && 
						   breadHref != '/keystone/blog-categories' &&
						   breadHref != '/keystone/subscribers' &&
						   breadHref != '/keystone/users'){
						   	lia.attr('href', breadHref+'?sort=sort')
						}
					}
				}
			}
		},10)
		






		if(/^\/keystone\/shops$/.test(curUri)){
		
			setTimeout(function(){
				$('a[data-path="zipcode"]').eq(0).click()
			},100)

		}





	})





script(src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAxoHn2ExXBMjvV522DUrL-5jeFZ3im_PU",async,defer)